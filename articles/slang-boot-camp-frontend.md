---
title: "å­¦æ ¡ã‚„ TOEIC ã§çµ¶å¯¾å‡ºã¦ã“ãªã„è‹±èªãƒ•ãƒ¬ãƒ¼ã‚ºã®ç™ºéŸ³ç·´ç¿’ãŒå‡ºæ¥ã‚‹ã‚¯ã‚½ã‚¢ãƒ—ãƒª"
emoji: "ğŸ—£ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "nextjs"
  - "react"
  - "amplify"
  - "aws"
  - "english"
published: false
---

:::message
ã“ã®è¨˜äº‹ã¯ [ã‚¯ã‚½ã‚¢ãƒ—ãƒª Advent Calendar 2022](https://qiita.com/advent-calendar/2022/kuso-app) 13 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚
:::

ã“ã‚“ã«ã¡ã‚ã€‚ [ZUMA](https://twitter.com/zuma_lab) ã§ã™ã€‚

ã‚¯ã‚½ã‚¢ãƒ—åˆå‚åŠ ã§ã™ã€‚ãŠæ‰‹æŸ”ã‚‰ã‹ã«ãŠé¡˜ã„ã—ã¾ã™ã€‚

å­¦æ ¡ã‚„ TOEIC ã®ãƒ†ã‚¹ãƒˆã§ã¯çµ¶å¯¾å‡ºã¦ã“ãªã„ã§ã‚ã‚ã†ã‚¹ãƒ©ãƒ³ã‚°ã®ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã¨ç™ºéŸ³ç·´ç¿’ãŒå‡ºæ¥ã‚‹ Slang Boot Camp ã¨ã„ã† WEB ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚

ã“ã®ã‚¢ãƒ—ãƒªã§è¦šãˆãŸãƒ•ãƒ¬ãƒ¼ã‚ºã¯è‹±èªã®ãƒ†ã‚¹ãƒˆã§ä¸€åˆ‡å½¹ã«ç«‹ãŸãªã„äº‹ã‚’ä¿è¨¼ã„ãŸã—ã¾ã™ã€‚

# å‹•æ©Ÿ

ç­†è€…ã®è‹±èªåŠ›ã¯ä¸­äºŒãƒ¬ãƒ™ãƒ«ã§ã™ã€‚

ã„ã¤ã‹å­—å¹•ç„¡ã—ã§æ´‹ç”»ã‚’è¦³ã‚‹ã¨ã„ã†ç›®æ¨™ãŒã‚ã‚Šã¾ã™ãŒã€ç¾çŠ¶ãƒãƒªã‚¦ãƒƒãƒ‰ä¿³å„ªãŒä½•ã‚’è¨€ã£ã¦ã‚‹ã®ã‹ã‚µãƒƒãƒ‘ãƒªã‚ã‹ã‚Šã¾ã›ã‚“ã€‚

ç­†è€…ãŒãƒªã‚¹ãƒ‹ãƒ³ã‚°å‡ºæ¥ãªã„ç†ç”±ã¨ã—ã¦ä¸»ã«ä»¥ä¸‹ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

- è‹±èªåŠ›ãŒä¸­äºŒã§æ­¢ã¾ã£ã¦ã„ã‚‹
- ãƒãƒªã‚¦ãƒƒãƒ‰ä¿³å„ªé”ã®ä¼šè©±ãŒé€Ÿãã¦è¿½ã„ã¤ã‘ãªã„
- ãƒªãƒ³ã‚­ãƒ³ã‚°(å˜èªé–“ãŒç¹‹ãŒã£ã¦ã‚‹)ã—ã¦ã‚‹
- ãƒªãƒ€ã‚¯ã‚·ãƒ§ãƒ³(æœ¬æ¥ç™ºéŸ³ã•ã‚Œã‚‹ã¹ãéŸ³ãŒç™ºéŸ³ã•ã‚Œã¦ãªã„)ã—ã¦ã‚‹
- **ã‚¹ãƒ©ãƒ³ã‚°ã‚ã£ã¡ã‚ƒä½¿ã£ã¦ã‚‹**

è‹±èªå­¦ç¿’ã«ãŠã„ã¦ä»–ã«ã‚„ã‚‹ã“ã¨å±±ã®å¦‚ã—ã§ã™ãŒã€ã¨ã‚Šã‚ãˆãšã‚¹ãƒ©ãƒ³ã‚°è¦šãˆãŸã„ãªãƒ¼ã¨æ€ã£ã¦ã“ã®ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚

# ã“ã‚“ãªã‚“ã§ã™

ä»¥ä¸‹æˆæœç‰©ã§ã™ã€‚

ã¾ãšè‹±èªå•é¡Œæ–‡ãŒèª­ã¿ä¸Šã’ã‚Œã¾ã™ã€‚æ¬¡ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã—ãŸå•é¡Œæ–‡ã‚’ã‚¹ãƒ”ãƒ¼ã‚­ãƒ³ã‚°ã—ã¾ã™ã€‚

ç™ºéŸ³ãŒæ­£ã—ã‘ã‚Œã°æ—¥æœ¬èªè¨³ã®è§£ç­”ãŒè¡¨ç¤ºã•ã‚Œæ¬¡ã®å•é¡ŒãŒå‡ºé¡Œã•ã‚Œã¾ã™ã€‚

ç™ºéŸ³ãŒæ­£ã—ã‘ã‚Œã°ã™ã‚Œã°ã‚¹ãƒ©ãƒ³ã‚°ã§ç¥ã£ã¦ãã‚Œã¾ã™ã—ã€é–“é•ã£ã¦ã„ã‚Œã°ã‚¹ãƒ©ãƒ³ã‚°ã§ç½µã‚‰ã‚Œã¾ã™ã€‚

ç­†è€…ãŒç‹¬æ–­ã¨åè¦‹ã§ãƒ¬ãƒ™ãƒ«åˆ†ã‘ã‚’ã—ãŸå•é¡ŒãŒå…¨éƒ¨ã§ 30 å•ã‚ã‚Šã¾ã™ã€‚

æ­£ç›´å®Ÿè£…ã¨ã‹ã‚ˆã‚Šã€å•é¡Œè€ƒãˆã‚‹ã»ã†ãŒå¤§å¤‰ã§ã—ãŸã€‚

# ã‚„ã£ã¦ã‚‹ã“ã¨

æŠ€è¡“çš„ã«ã¯ AWS Amplify ã® Predications ã‚«ãƒ†ã‚´ãƒª(Amazon Polly ã¨ Amazon Transcribe)ã€ Next.js ã¨ React Audio Player ã‚’ä½¿ã£ã¦ã¾ã™ã€‚

1. Amazon Polly ã§å•é¡Œæ–‡èª­ã¿ä¸Šã’
1. React Audio Player ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®éŸ³å£°ã‚’éŒ²éŸ³
1. Amazon Transcribe ã§éŸ³å£°ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›
1. å¤‰æ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¨å•é¡Œæ–‡ãŒåˆã£ã¦ã„ã‚‹ã‹åˆ¤å®š
1. åˆã£ã¦ã„ã‚Œã°æ¬¡ã®å•é¡Œ

# å®Ÿè¡Œç’°å¢ƒ

- Node
  - 16.13.0
- npm
  - 8.1.0
- Next.js
  - 13.0.5
- Amplify CLI
  - 10.5.2

# Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```
npx create-next-app@latest --ts --use-npm --eslint slang-boot-camp-frontend
```

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•ã—ã¾ã™ã€‚

```
cd slang-boot-camp-frontend
```

Amplify é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
npm install aws-amplify @aws-amplify/predictions
```

éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹ç‚ºã€React Audio Player ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
npm install react-audio-player
```

# éŸ³å£°éŒ²éŸ³ã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¤ã„ã¦

Amplify Predictions ã‚«ãƒ†ã‚´ãƒªã® Amazon Transcribe ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°æ–‡å­—èµ·ã“ã—ãŒå‡ºæ¥ã‚‹ Amazon Transcribe Streaming ã‚’ä½¿ç”¨ã—ã¦ stream å‡¦ç†ã‚’ã—ã¦ã„ã¾ã™ã€‚

https://docs.aws.amazon.com/transcribe/latest/dg/streaming.html

å®Ÿéš›ã«ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ Amazon Transcribe ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ URL ã‚’è¦‹ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã« websocket é€šä¿¡ã‚’ã—ã¦ã„ã‚‹äº‹ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

`media-encoding=pcm` ã‚¯ã‚¨ãƒªãŒä»˜ã„ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€PCM ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```
wss://transcribestreaming.ap-northeast-1.amazonaws.com:8443/stream-transcription-websocket?media-encoding=pcm&sample-rate=16000&language-code=en-US&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIATNKHGROELN3BCD6P%2F20221213%2Fap-northeast-1%2Ftranscribe%2Faws4_request&X-Amz-Date=20221213T....
```

é€šå¸¸ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰éŸ³å£°éŒ²éŸ³ã‚’ã™ã‚‹æ™‚ã¯ Web æ¨™æº– API ã® MediaRecorderã€React Audio Recorder ãªã©ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ãƒ–ãƒ©ã‚¦ã‚¶çµŒç”±ã§ãƒã‚¤ã‚¯ã‹ã‚‰éŸ³å£°éŒ²éŸ³ã€ WAV ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã§ã™ãŒã€ä»Šå›ã¯ Amazon Transcribe Streaming ã® stream å‡¦ç†ã§ WAV ã«ã™ã‚‹å‰ã®ç”Ÿ PCM ãƒ‡ãƒ¼ã‚¿ã‚’ Websocket ã§ã‚„ã‚Šå–ã‚Šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä»Šå›ã¯éŸ³å£°ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã‚’ã™ã‚‹ç‚ºã€ microphone-stream ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
npm install microphone-stream
```

ä»Šå›ã€ä¸€ç•ªã®ãƒãƒã‚Šæ‰€ãŒã“ã® stream å‡¦ç†ã§ã—ãŸã€‚ã€‚ã€‚

ä»¥ä¸‹å…¬å¼ã®ã‚„ã‚Šæ–¹ãŒã‚ã‚‹ã®ã§ã™ãŒã€ç´ ç›´ã« Javascript ã‹ã‚‰ Typescript ã«æ›¸ãç›´ã—ã¦ã‚‚å‹•ã‹ãªã‹ã£ãŸã®ã§çµæ§‹ãƒãƒã‚Šã¾ã—ãŸã€‚

éœ€è¦ãŒç„¡ã„ã®ã‹ã€å…¬å¼ã‚‚å«ã‚æƒ…å ±ãŒå…¨ç„¶å‡ºã¦ãã¾ã›ã‚“ã€‚

https://docs.amplify.aws/lib/predictions/sample/q/platform/js/

æœ€çµ‚çš„ã«ãªã‚“ã¨ã‹è‡ªåŠ›ã§å‹•ã‹ã™ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚

# Amplify ã‚’è¨­å®šã™ã‚‹

Amplify Predictions ã‚«ãƒ†ã‚´ãƒªã‚’ä½¿ç”¨ã™ã‚‹ç‚ºã«ã¯ Amplify Auth ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## Amplify Auth ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹

å‰æã¨ã—ã¦ `amplify configure` ã§ Amplify ã§ä½¿ç”¨ã™ã‚‹ AWS ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãª IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä½œæˆæ¸ˆã¿ã¨ã—ã¾ã™ã€‚

ã¾ãŸã€ `amplify init` ã§ Amplify ã®åˆæœŸåŒ–æ¸ˆã¿ã¨ã—ã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ Amplify Auth ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚

```
amplify add auth
```

Cognito ã®è¨­å®šã¯æœ€ä½é™ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã¿ã®èªè¨¼ã¨ã—ã¾ã™ã€‚

```
Using service: Cognito, provided by: awscloudformation

 The current configured provider is Amazon Cognito.

 Do you want to use the default authentication and security configuration?
â¯ Default configuration
  Default configuration with Social Provider (Federation)
  Manual configuration
  I want to learn more.
 How do you want users to be able to sign in?
  Username
â¯ Email
  Phone Number
  Email or Phone Number
  I want to learn more.
 Do you want to configure advanced settings? (Use arrow keys)
â¯ No, I am done.
  Yes, I want to make some additional changes.
âœ… Successfully added auth resource nextjscognitomiddlewe0c8d7ed locally

âœ… Some next steps:
"amplify push" will build all your local backend resources and provision it in the cloud
"amplify publish" will build all your local backend and frontend resources (if you have hosting category added) and provision it in the cloud
```

# Amplify Predictions ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹

## Text to speech (Amazon Polly) ã‚’è¿½åŠ ã™ã‚‹

è‹±èªå•é¡Œæ–‡ã‚’èª­ã¿ä¸Šã’ã‚‹ç‚ºã€Amazon Polly ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¦ Amplify Predictions ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚

```
amplify add predictions
```

ä»¥ä¸‹è¨­å•ã¯ `Convert` ã‚’é¸æŠã—ã¾ã™ã€‚

```
? Please select from one of the categories below
  Identify
â¯ Convert
  Interpret
  Infer
  Learn More
```

ä»¥ä¸‹è¨­å•ã¯ `Generate speech audio from text` ã‚’é¸æŠã—ã¾ã™ã€‚

```
? What would you like to convert?
  Translate text into a different language
â¯ Generate speech audio from text
  Transcribe text from audio
```

ä»¥ä¸‹è¨­å•ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã¨ã—ã¾ã™ã€‚

```
? Provide a friendly name for your resource (speechGeneratora239dcbe)
```

ã‚½ãƒ¼ã‚¹ã¨ãªã‚‹ãƒ†ã‚­ã‚¹ãƒˆã®è¨€èªã‚’è¨­å®šã—ã¾ã™ã€‚ US English ã‚’é¸æŠã—ã¾ã™ã€‚

```
? What is the source language? (Use arrow keys)
â¯ US English
  Turkish
  Swedish
  Russian
  Romanian
  Portuguese
  Brazilian Portuguese
(Move up and down to reveal more choices)
```

éŸ³å£°èª­ã¿ä¸Šã’ã‚’ã™ã‚‹ã‚­ãƒ£ãƒ©(?)ã‚’é¸æŠã—ã¾ã™ã€‚

ä»Šå›ã¯ Kevin ã«ã—ã¾ã—ãŸã€‚

```
? Select a speaker (Use arrow keys)
â¯ Kevin - Male
  Salli - Female
  Matthew - Male
  Kimberly - Female
  Kendra - Female
  Justin - Male
  Joey - Male
```

ä»Šå›ã¯æœªèªè¨¼ã®ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```
? Who should have access?
  Auth users only
â¯ Auth and Guest users
```

## Transcribe audio to text (Amazon Transcribe) ã‚’è¿½åŠ ã™ã‚‹

æ¬¡ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®éŸ³å£°ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã™ã‚‹ç‚ºã€Amazon Transcribe ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å†åº¦å®Ÿè¡Œã—ã¾ã™ã€‚

```
amplify add predictions
```

ä»¥ä¸‹è¨­å•ã¯ `Convert` ã‚’é¸æŠã—ã¾ã™ã€‚

```
? Please select from one of the categories below
  Identify
â¯ Convert
  Interpret
  Infer
  Learn More
```

ä»¥ä¸‹è¨­å•ã¯ `Transcribe text from audio` ã‚’é¸æŠã—ã¾ã™ã€‚

```
? What would you like to convert?
  Translate text into a different language
  Generate speech audio from text
â¯ Transcribe text from audio
```

ä»¥ä¸‹è¨­å•ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã¨ã—ã¾ã™ã€‚

```
? Provide a friendly name for your resource (transcription0e88a3c3)
```

ã‚½ãƒ¼ã‚¹ã¨ãªã‚‹éŸ³å£°ã®è¨€èªã‚’é¸æŠã—ã¾ã™ã€‚US English ã‚’é¸æŠã—ã¾ã™ã€‚

```
? What is the source language?
  British English
â¯ US English
  French
  Canadian French
  US Spanish
```

æœªèªè¨¼ã®ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å‡ºæ¥ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```
? Who should have access?
  Auth users only
â¯ Auth and Guest users
```

ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹ã¨ã€ä»¥ä¸‹ `aws-exports.js` ã«é …ç›®ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

```json:bacend-config.json
    "predictions": {
        "convert": {
            "speechGenerator": {
                "region": "ap-northeast-1",
                "proxy": false,
                "defaults": {
                    "VoiceId": "Kevin",
                    "LanguageCode": "en-US"
                }
            },
            "transcription": {
                "region": "ap-northeast-1",
                "proxy": false,
                "defaults": {
                    "language": "en-US"
                }
            }
        }
    }
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã—ãŸ Amplify Auth ã¨ Predications ã‚«ãƒ†ã‚´ãƒªã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã«ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚

```
amplify push -y
```

# ç”»é¢ã‚’å®Ÿè£…ã™ã‚‹
